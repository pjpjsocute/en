<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/en/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/en/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/en/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/en/images/logo.svg" color="#222">

<link rel="stylesheet" href="/en/css/main.css">


<link rel="stylesheet" href="/en/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"pjpjsocute.github.io","root":"/en/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="Target:Since there are too many files in Confluence at work, which are also cluttered and difficult to read, I hope chatGPT-based can help me quickly get the knowledge I want from the files">
<meta property="og:type" content="article">
<meta property="og:title" content="chatGPT with confluence">
<meta property="og:url" content="http://pjpjsocute.github.io/en/2023/05/12/algorithm/chatGPT-with-confluence/index.html">
<meta property="og:site_name" content="Ray‘s Blog">
<meta property="og:description" content="Target:Since there are too many files in Confluence at work, which are also cluttered and difficult to read, I hope chatGPT-based can help me quickly get the knowledge I want from the files">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://pjpjsocute.github.io/en/en/2023/05/12/algorithm/chatGPT-with-confluen/output_7_1-3877587.png">
<meta property="og:image" content="http://pjpjsocute.github.io/en/en/2023/05/12/algorithm/chatGPT-with-confluen/output_8_1-3877587.png">
<meta property="article:published_time" content="2023-05-12T07:44:05.000Z">
<meta property="article:modified_time" content="2023-05-12T14:18:17.000Z">
<meta property="article:author" content="Ray zhou">
<meta property="article:tag" content="python">
<meta property="article:tag" content="chatGpt">
<meta property="article:tag" content="algorithm">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://pjpjsocute.github.io/en/en/2023/05/12/algorithm/chatGPT-with-confluen/output_7_1-3877587.png">

<link rel="canonical" href="http://pjpjsocute.github.io/en/2023/05/12/algorithm/chatGPT-with-confluence/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>chatGPT with confluence | Ray‘s Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/en/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Ray‘s Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/en/" rel="section"><i class="home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/en/tags/" rel="section"><i class="tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/en/categories/" rel="section"><i class="th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/en/archives/" rel="section"><i class="archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/en/about/" rel="section"><i class="user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-中文">

    <a href="https://pjpjsocute.github.io/" rel="section"><i class="中文 fa-fw"></i>中文</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://pjpjsocute.github.io/en/2023/05/12/algorithm/chatGPT-with-confluence/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/en/images/avatar.gif">
      <meta itemprop="name" content="Ray zhou">
      <meta itemprop="description" content="My bolg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ray‘s Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          chatGPT with confluence
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2023-05-12 15:44:05 / Modified: 22:18:17" itemprop="dateCreated datePublished" datetime="2023-05-12T15:44:05+08:00">2023-05-12</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/en/categories/technology/" itemprop="url" rel="index"><span itemprop="name">technology</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h3 id="Target"><a href="#Target" class="headerlink" title="Target:"></a>Target:</h3><p>Since there are too many files in Confluence at work, which are also cluttered and difficult to read, I hope chatGPT-based can help me quickly get the knowledge I want from the files</p>
<span id="more"></span>
<p>Here is the code of a demo, referring to the GPT official website</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##crawler</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> deque</span><br><span class="line"><span class="keyword">from</span> html.parser <span class="keyword">import</span> HTMLParser</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urlparse</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> html2text</span><br><span class="line"><span class="keyword">from</span> atlassian <span class="keyword">import</span> Confluence</span><br><span class="line"><span class="keyword">import</span> tiktoken</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> openai</span><br><span class="line"><span class="keyword">from</span> openai.embeddings_utils <span class="keyword">import</span> distances_from_embeddings</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> openai.embeddings_utils <span class="keyword">import</span> distances_from_embeddings, cosine_similarity</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># public account and confluence space configuration</span></span><br><span class="line">domain = <span class="string">&quot;confluence.xxxxx.com&quot;</span></span><br><span class="line">full_url = <span class="string">&quot;https://confluence.xxxxx.com/&quot;</span></span><br><span class="line">login_url = <span class="string">&quot;https://confluence.xxxxx.com/login.action?os_destination=%2Fdologin.action&quot;</span></span><br><span class="line">page_url = <span class="string">&quot;https://confluence.xxxxx.com/display/41JTSP/&quot;</span></span><br><span class="line">user_name = <span class="string">&quot;xxxx&quot;</span></span><br><span class="line">password = <span class="string">&quot;xxxx&quot;</span></span><br><span class="line"><span class="comment"># Define the space key to be crawled, which is currently our space</span></span><br><span class="line">space_key = <span class="string">&quot;xxxx&quot;</span></span><br><span class="line"><span class="comment">##Data saving address, please customize</span></span><br><span class="line">filePath = <span class="string">&quot;&quot;</span></span><br><span class="line">processPath = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##Separators and replacements, mainly for file name generation and title reduction</span></span><br><span class="line">splitFlag = <span class="string">&quot;$&quot;</span></span><br><span class="line">replaceFlag = <span class="string">&quot;_&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">##Setting up openai environment</span></span><br><span class="line">openai.organization = <span class="string">&quot;&quot;</span></span><br><span class="line">openai.api_key = <span class="string">&quot;&quot;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">crawler</span>(<span class="params">base_url,username,password,space_key,totalSpace = <span class="literal">False</span></span>):</span><br><span class="line">    confluence = Confluence(url=base_url, username=username, password=password)</span><br><span class="line">    <span class="comment">##To be implemented, crawl all spaces</span></span><br><span class="line">    <span class="comment">##Get the corresponding space</span></span><br><span class="line">    space = confluence.get_space(space_key, expand=<span class="string">&#x27;description.plain,homepage&#x27;</span>)</span><br><span class="line">    <span class="comment">##get space page id</span></span><br><span class="line">    page_id = space[<span class="string">&quot;homepage&quot;</span>][<span class="string">&quot;id&quot;</span>]</span><br><span class="line">    </span><br><span class="line">        <span class="comment"># Create a directory to store the text files</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(filePath):</span><br><span class="line">            os.mkdir(filePath)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Create a directory to store the csv files</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(processPath):</span><br><span class="line">            os.mkdir(processPath)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">##subpage</span></span><br><span class="line">    child = confluence.get_page_child_by_type(page_id, <span class="built_in">type</span>=<span class="string">&#x27;page&#x27;</span>, start=<span class="literal">None</span>, limit=<span class="literal">None</span>, expand=<span class="literal">None</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">##init queue</span></span><br><span class="line">    queue = deque()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> child:</span><br><span class="line">        queue.append(i)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> queue:</span><br><span class="line">        <span class="comment"># Get the next URL from the queue</span></span><br><span class="line">        childPage = queue.pop()</span><br><span class="line">        <span class="comment">##get page id</span></span><br><span class="line">        html = confluence.get_page_by_id(childPage[<span class="string">&quot;id&quot;</span>], expand=<span class="string">&quot;body.storage&quot;</span>)</span><br><span class="line">        <span class="comment"># html-&gt;text</span></span><br><span class="line">        content = html[<span class="string">&quot;body&quot;</span>][<span class="string">&quot;storage&quot;</span>][<span class="string">&quot;value&quot;</span>]</span><br><span class="line">        content_text = html2text.html2text(content)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">##insert not null</span></span><br><span class="line">        <span class="keyword">if</span> content_text.lstrip() != <span class="string">&quot;&quot;</span>:</span><br><span class="line">            title = <span class="built_in">str</span>(html[<span class="string">&quot;title&quot;</span>]).replace(<span class="string">&quot;/&quot;</span>,replaceFlag)</span><br><span class="line">    <span class="comment">#         if not os.path.exists(&quot;/Users/lei.zhou/text/&quot;+html[&quot;title&quot;]):</span></span><br><span class="line">    <span class="comment">#             os.mkdir(&quot;/Users/lei.zhou/text/&quot;)</span></span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(filePath+ childPage[<span class="string">&quot;id&quot;</span>]+splitFlag+title+ <span class="string">&quot;.txt&quot;</span>, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                f.write(content_text)</span><br><span class="line"></span><br><span class="line">        <span class="comment">##add sub point‘</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> confluence.get_page_child_by_type(childPage[<span class="string">&quot;id&quot;</span>], <span class="built_in">type</span>=<span class="string">&#x27;page&#x27;</span>, start=<span class="literal">None</span>, limit=<span class="literal">None</span>, expand=<span class="literal">None</span>):</span><br><span class="line">            queue.append(i)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line">max_tokens = <span class="number">500</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">remove_newlines</span>(<span class="params">serie</span>):</span><br><span class="line">    serie = serie.<span class="built_in">str</span>.replace(<span class="string">&#x27;\n&#x27;</span>, <span class="string">&#x27; &#x27;</span>)</span><br><span class="line">    serie = serie.<span class="built_in">str</span>.replace(<span class="string">&#x27;\\n&#x27;</span>, <span class="string">&#x27; &#x27;</span>)</span><br><span class="line">    serie = serie.<span class="built_in">str</span>.replace(<span class="string">&#x27;  &#x27;</span>, <span class="string">&#x27; &#x27;</span>)</span><br><span class="line">    serie = serie.<span class="built_in">str</span>.replace(<span class="string">&#x27;  &#x27;</span>, <span class="string">&#x27; &#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> serie</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_context</span>(<span class="params"></span></span><br><span class="line"><span class="params">    question, df, max_len=<span class="number">1800</span>, size=<span class="string">&quot;ada&quot;</span></span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Find the most similar text segment</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># Get the embeddings for the question</span></span><br><span class="line">    q_embeddings = openai.Embedding.create(<span class="built_in">input</span>=question, engine=<span class="string">&#x27;text-embedding-ada-002&#x27;</span>)[<span class="string">&#x27;data&#x27;</span>][<span class="number">0</span>][<span class="string">&#x27;embedding&#x27;</span>]</span><br><span class="line">    <span class="comment"># Calculate the most similar text using the cosine algorithm</span></span><br><span class="line">    df[<span class="string">&#x27;distances&#x27;</span>] = distances_from_embeddings(q_embeddings, df[<span class="string">&#x27;embeddings&#x27;</span>].values, distance_metric=<span class="string">&#x27;cosine&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    returns = []</span><br><span class="line">    cur_len = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Keep adding text to the upper limit</span></span><br><span class="line">    <span class="keyword">for</span> i, row <span class="keyword">in</span> df.sort_values(<span class="string">&#x27;distances&#x27;</span>, ascending=<span class="literal">True</span>).iterrows():</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Text creation</span></span><br><span class="line">        cur_len += row[<span class="string">&#x27;n_tokens&#x27;</span>] + <span class="number">4</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Exits when limit is exceeded</span></span><br><span class="line">        <span class="keyword">if</span> cur_len &gt; max_len.</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Add text</span></span><br><span class="line">        returns.append(row[<span class="string">&quot;text&quot;</span>])</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;\n\n###\n\n&quot;</span>.join(returns)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># token split</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">split_into_many</span>(<span class="params">text, max_tokens = max_tokens</span>):</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Define segmentation symbols, allowing customization</span></span><br><span class="line">    sentences = re.split(<span class="string">&#x27;[.。！？!?]&#x27;</span>,text)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># get token for each sentence</span></span><br><span class="line">    n_tokens = [<span class="built_in">len</span>(tokenizer.encode(<span class="string">&quot; &quot;</span> + sentence)) <span class="keyword">for</span> sentence <span class="keyword">in</span> sentences]</span><br><span class="line">    </span><br><span class="line">    chunks = []</span><br><span class="line">    tokens_so_far = <span class="number">0</span></span><br><span class="line">    chunk = []</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> sentence, token <span class="keyword">in</span> <span class="built_in">zip</span>(sentences, n_tokens):</span><br><span class="line"></span><br><span class="line">        <span class="comment"># If the number of tokens so far plus the number of tokens in the current sentence is greater than,greater than the maximum number of tokens, the block is added to the list of blocks and the number of blocks and tokens so far is reset</span></span><br><span class="line">        <span class="keyword">if</span> tokens_so_far + token &gt; max_tokens:</span><br><span class="line">            chunks.append(<span class="string">&quot;. &quot;</span>.join(chunk) + <span class="string">&quot;.&quot;</span>)</span><br><span class="line">            chunk = []</span><br><span class="line">            tokens_so_far = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">        <span class="keyword">if</span> token &gt; max_tokens:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">        chunk.append(sentence)</span><br><span class="line">        tokens_so_far += token + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> chunks</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">answer_question</span>(<span class="params"></span></span><br><span class="line"><span class="params">    df,</span></span><br><span class="line"><span class="params">    model=<span class="string">&quot;text-davinci-003&quot;</span>,</span></span><br><span class="line"><span class="params">    question=<span class="string">&quot;what&#x27;s your problem&quot;</span>,</span></span><br><span class="line"><span class="params">    max_len=<span class="number">1800</span>,</span></span><br><span class="line"><span class="params">    size=<span class="string">&quot;ada&quot;</span>,</span></span><br><span class="line"><span class="params">    debug=<span class="literal">False</span>,</span></span><br><span class="line"><span class="params">    max_tokens=<span class="number">1800</span>,</span></span><br><span class="line"><span class="params">    stop_sequence=<span class="literal">None</span>,</span></span><br><span class="line"><span class="params">    use_GPT=<span class="literal">False</span></span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    answer</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    context = create_context(</span><br><span class="line">        question,</span><br><span class="line">        df,</span><br><span class="line">        max_len=max_len,</span><br><span class="line">        size=size,</span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># If debug, print the raw model response</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Context:\n&quot;</span> + context)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n\n&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Answer the question based on the context below, and if the question can&#x27;t be answered based on the context, say \&quot;I don&#x27;t know\&quot;\n\nContext: <span class="subst">&#123;context&#125;</span>\n\n---\n\nQuestion: <span class="subst">&#123;question&#125;</span>\nAnswer:&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> use_GPT:</span><br><span class="line">        completion = openai.ChatCompletion.create(model=<span class="string">&quot;gpt-3.5-turbo&quot;</span>,messages=[</span><br><span class="line">    &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">f&quot;Answer the question based on the context below, and if the question can&#x27;t be answered based on the context, say \&quot;I don&#x27;t know\&quot;\n\nContext: <span class="subst">&#123;context&#125;</span>\n\n---\n\nQuestion: <span class="subst">&#123;question&#125;</span>\nAnswer:&quot;</span>&#125;])</span><br><span class="line">        <span class="keyword">return</span> completion.to_dict()[<span class="string">&quot;choices&quot;</span>][<span class="number">0</span>][<span class="string">&quot;message&quot;</span>][<span class="string">&quot;content&quot;</span>]</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># Create a completions using the question and context</span></span><br><span class="line">        response = openai.Completion.create(</span><br><span class="line">            prompt=<span class="string">f&quot;Answer the question based on the context below, and if the question can&#x27;t be answered based on the context, say \&quot;I don&#x27;t know\&quot;\n\nContext: <span class="subst">&#123;context&#125;</span>\n\n---\n\nQuestion: <span class="subst">&#123;question&#125;</span>\nAnswer:&quot;</span>,</span><br><span class="line">            temperature=<span class="number">0</span>,</span><br><span class="line">            max_tokens=max_tokens,</span><br><span class="line">            top_p=<span class="number">1</span>,</span><br><span class="line">            frequency_penalty=<span class="number">0</span>,</span><br><span class="line">            presence_penalty=<span class="number">0</span>,</span><br><span class="line">            stop=stop_sequence,</span><br><span class="line">            model=model,</span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">return</span> response[<span class="string">&quot;choices&quot;</span>][<span class="number">0</span>][<span class="string">&quot;text&quot;</span>].strip()</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(e)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crawler(base_url,username,password,space_key)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Original Text</span></span><br><span class="line">texts=[]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> file <span class="keyword">in</span> os.listdir(filePath):</span><br><span class="line">    <span class="comment"># file read</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filePath+file, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        titles = file.split(splitFlag)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(titles) &lt;= <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        title = titles[<span class="number">1</span>]</span><br><span class="line">        text = f.read()</span><br><span class="line">        <span class="comment"># Title restore, replace _ with a space insert</span></span><br><span class="line">        texts.append((title.replace(replaceFlag,<span class="string">&quot; &quot;</span>), text))</span><br><span class="line">        </span><br><span class="line">df = pd.DataFrame(texts, columns = [<span class="string">&#x27;fname&#x27;</span>, <span class="string">&#x27;text&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># split by row</span></span><br><span class="line">df[<span class="string">&#x27;text&#x27;</span>] = df.fname + <span class="string">&quot;. &quot;</span> + remove_newlines(df.text)</span><br><span class="line">df.to_csv(<span class="string">&#x27;processed/scraped.csv&#x27;</span>)</span><br><span class="line">df.head()</span><br></pre></td></tr></table></figure>
<p></p>
<table border="1" class="dataframe"><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>fname</th><br>      <th>text</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>0</th><br>      <td>2022-12-15【VWASP】【IDP】Scan qrcode login HU to …</td><br>      <td>2022-12-15【VWASP】【IDP】Scan qrcode login HU to …</td><br>    </tr><br>    <tr><br>      <th>1</th><br>      <td>2022-12-19   【VWASP】【StartupBroadcasting】Conte…</td><br>      <td>2022-12-19   【VWASP】【StartupBroadcasting】Conte…</td><br>    </tr><br>    <tr><br>      <th>2</th><br>      <td>bak.B1.1 Payment Center Integration Test Repor…</td><br>      <td>bak.B1.1 Payment Center Integration Test Repor…</td><br>    </tr><br>    <tr><br>      <th>3</th><br>      <td>2022-03-15  [VWASP] 【ULH】DP token exchange wit…</td><br>      <td>2022-03-15  [VWASP] 【ULH】DP token exchange wit…</td><br>    </tr><br>    <tr><br>      <th>4</th><br>      <td>OnlineRadio and OlineMusic B0.2 testcase revie…</td><br>      <td>OnlineRadio and OlineMusic B0.2 testcase revie…</td><br>    </tr><br>  </tbody><br></table>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">tokenizer = tiktoken.get_encoding(<span class="string">&quot;cl100k_base&quot;</span>)</span><br><span class="line"></span><br><span class="line">df = pd.read_csv(<span class="string">&#x27;processed/scraped.csv&#x27;</span>, index_col=<span class="number">0</span>)</span><br><span class="line">df.columns = [<span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;text&#x27;</span>]</span><br><span class="line"></span><br><span class="line">df[<span class="string">&#x27;n_tokens&#x27;</span>] = df.text.apply(<span class="keyword">lambda</span> x: <span class="built_in">len</span>(tokenizer.encode(x)))</span><br><span class="line"></span><br><span class="line">df</span><br></pre></td></tr></table></figure>
<p></p>
<table border="1" class="dataframe"><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>title</th><br>      <th>text</th><br>      <th>n_tokens</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>0</th><br>      <td>2022-12-15【VWASP】【IDP】Scan qrcode login HU to …</td><br>      <td>2022-12-15【VWASP】【IDP】Scan qrcode login HU to …</td><br>      <td>1423</td><br>    </tr><br>    <tr><br>      <th>1</th><br>      <td>2022-12-19   【VWASP】【StartupBroadcasting】Conte…</td><br>      <td>2022-12-19   【VWASP】【StartupBroadcasting】Conte…</td><br>      <td>1355</td><br>    </tr><br>    <tr><br>      <th>2</th><br>      <td>bak.B1.1 Payment Center Integration Test Repor…</td><br>      <td>bak.B1.1 Payment Center Integration Test Repor…</td><br>      <td>1106</td><br>    </tr><br>    <tr><br>      <th>3</th><br>      <td>2022-03-15  [VWASP] 【ULH】DP token exchange wit…</td><br>      <td>2022-03-15  [VWASP] 【ULH】DP token exchange wit…</td><br>      <td>1429</td><br>    </tr><br>    <tr><br>      <th>4</th><br>      <td>OnlineRadio and OlineMusic B0.2 testcase revie…</td><br>      <td>OnlineRadio and OlineMusic B0.2 testcase revie…</td><br>      <td>2736</td><br>    </tr><br>    <tr><br>      <th>…</th><br>      <td>…</td><br>      <td>…</td><br>      <td>…</td><br>    </tr><br>    <tr><br>      <th>412</th><br>      <td>B1 OnePortal Qulification Test Report.txt</td><br>      <td>B1 OnePortal Qulification Test Report.txt.   #…</td><br>      <td>966</td><br>    </tr><br>    <tr><br>      <th>413</th><br>      <td>Detailed Solution Architecture.txt</td><br>      <td>Detailed Solution Architecture.txt. 250</td><br>      <td>8</td><br>    </tr><br>    <tr><br>      <th>414</th><br>      <td>B1.3 Release.txt</td><br>      <td>B1.3 Release.txt. true</td><br>      <td>9</td><br>    </tr><br>    <tr><br>      <th>415</th><br>      <td>04  B1验收Charging&amp;RBC.txt</td><br>      <td>04  B1验收Charging&amp;RBC.txt.  L1| L2| L3| | | L4|…</td><br>      <td>1492</td><br>    </tr><br>    <tr><br>      <th>416</th><br>      <td>ULH - Integration Outline and API-Specificatio…</td><br>      <td>ULH - Integration Outline and API-Specificatio…</td><br>      <td>38</td><br>    </tr><br>  </tbody><br></table><br><p>417 rows × 3 columns</p><br><br><br><br><br><br><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Tokenize the text and save the number of tokens to a new column</span></span><br><span class="line">df[<span class="string">&#x27;n_tokens&#x27;</span>] = df.text.apply(<span class="keyword">lambda</span> x: <span class="built_in">len</span>(tokenizer.encode(x)))</span><br><span class="line"></span><br><span class="line"><span class="comment"># Visualize the distribution of the number of tokens per row using a histogram</span></span><br><span class="line">df.n_tokens.hist()</span><br></pre></td></tr></table></figure><br><br><br><br><br>    <a href="AxesSubplot:">AxesSubplot:</a><br><br><br><br><br><img src="/en/en/2023/05/12/algorithm/chatGPT-with-confluen/output_7_1-3877587.png" alt="png"><br>​<br><br><br><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">shortened = []</span><br><span class="line"></span><br><span class="line"><span class="comment"># Cyclic text reduction</span></span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> df.iterrows():</span><br><span class="line">    <span class="built_in">print</span>(row)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> row[<span class="number">1</span>][<span class="string">&#x27;text&#x27;</span>] <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> row[<span class="number">1</span>][<span class="string">&#x27;n_tokens&#x27;</span>] &gt; max_tokens:</span><br><span class="line">        shortened += split_into_many(row[<span class="number">1</span>][<span class="string">&#x27;text&#x27;</span>])</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        shortened.append( row[<span class="number">1</span>][<span class="string">&#x27;text&#x27;</span>] )</span><br><span class="line">df = pd.DataFrame(shortened, columns = [<span class="string">&#x27;text&#x27;</span>])</span><br><span class="line">df[<span class="string">&#x27;n_tokens&#x27;</span>] = df.text.apply(<span class="keyword">lambda</span> x: <span class="built_in">len</span>(tokenizer.encode(x)))</span><br><span class="line">df.n_tokens.hist()</span><br></pre></td></tr></table></figure><br><br><br><br><br><br><img src="/en/en/2023/05/12/algorithm/chatGPT-with-confluen/output_8_1-3877587.png" alt="png"><br>​<br><br><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## Due to the official limit, a maximum of 60 requests initiated in 1 minute, so to prevent the reporting of errors here active hibernation</span></span><br><span class="line"><span class="comment">## due to the amount of data is too large, if you can not run, you can intercept part of the data in the above column df = df[0:x] x is the interception length</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cal</span>(<span class="params">x,waittime = <span class="number">0.6</span></span>):</span><br><span class="line">    res = openai.Embedding.create(<span class="built_in">input</span>=x, engine=<span class="string">&#x27;text-embedding-ada-002&#x27;</span>)[<span class="string">&#x27;data&#x27;</span>][<span class="number">0</span>][<span class="string">&#x27;embedding&#x27;</span>]</span><br><span class="line">    time.sleep(waittime)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line">df[<span class="string">&#x27;embeddings&#x27;</span>] = df.text.apply(<span class="keyword">lambda</span> x: cal(x))</span><br><span class="line"></span><br><span class="line">df.to_csv(<span class="string">&#x27;processed/embeddings.csv&#x27;</span>)</span><br><span class="line">df.head()</span><br></pre></td></tr></table></figure><br><br><br><br><br><br><table border="1" class="dataframe"><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>text</th><br>      <th>n_tokens</th><br>      <th>embeddings</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>0</th><br>      <td>2022-12-15【VWASP】【IDP】Scan qrcode login HU to …</td><br>      <td>472</td><br>      <td>[-0.0035752991680055857, 0.015155627392232418,…</td><br>    </tr><br>    <tr><br>      <th>1</th><br>      <td>| 11 incomplete | /  6 | 用例设计是否包含充分的正面、负面异常测试…</td><br>      <td>343</td><br>      <td>[0.012331507168710232, 0.002946529071778059, -…</td><br>    </tr><br>    <tr><br>      <th>2</th><br>      <td>2022-12-19   【VWASP】【StartupBroadcasting】Conte…</td><br>      <td>454</td><br>      <td>[0.004054947756230831, -0.0028905682265758514,…</td><br>    </tr><br>    <tr><br>      <th>3</th><br>      <td>| 203 complete OK |  |   <strong>专属部分</strong> |  | 检查人：Zh…</td><br>      <td>492</td><br>      <td>[0.019448528066277504, 0.00747803645208478, 0….</td><br>    </tr><br>    <tr><br>      <th>4</th><br>      <td>bak. B1. 1 Payment Center Integration Test Rep…</td><br>      <td>481</td><br>      <td>[0.0010055731981992722, -0.013514618389308453,…</td><br>    </tr><br>  </tbody><br></table>

<p></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##read token</span></span><br><span class="line">df=pd.read_csv(<span class="string">&#x27;processed/embeddings.csv&#x27;</span>, index_col=<span class="number">0</span>)</span><br><span class="line">df[<span class="string">&#x27;embeddings&#x27;</span>] = df[<span class="string">&#x27;embeddings&#x27;</span>].apply(<span class="built_in">eval</span>).apply(np.array)</span><br><span class="line">df.head()</span><br></pre></td></tr></table></figure>
<p></p>
<p><table border="1" class="dataframe"><br>  <thead><br>    <tr style="text-align: right;"><br>      <th></th><br>      <th>text</th><br>      <th>n_tokens</th><br>      <th>embeddings</th><br>    </tr><br>  </thead><br>  <tbody><br>    <tr><br>      <th>0</th><br>      <td>2022-12-15【VWASP】【IDP】Scan qrcode login HU to …</td><br>      <td>472</td><br>      <td>[-0.0035752991680055857, 0.015155627392232418,…</td><br>    </tr><br>    <tr><br>      <th>1</th><br>      <td>| 11 incomplete | /  6 | 用例设计是否包含充分的正面、负面异常测试…</td><br>      <td>343</td><br>      <td>[0.012331507168710232, 0.002946529071778059, -…</td><br>    </tr><br>    <tr><br>      <th>2</th><br>      <td>2022-12-19   【VWASP】【StartupBroadcasting】Conte…</td><br>      <td>454</td><br>      <td>[0.004054947756230831, -0.0028905682265758514,…</td><br>    </tr><br>    <tr><br>      <th>3</th><br>      <td>| 203 complete OK |  |   <strong>专属部分</strong> |  | 检查人：Zh…</td><br>      <td>492</td><br>      <td>[0.019448528066277504, 0.00747803645208478, 0….</td><br>    </tr><br>    <tr><br>      <th>4</th><br>      <td>bak. B1. 1 Payment Center Integration Test Rep…</td><br>      <td>481</td><br>      <td>[0.0010055731981992722, -0.013514618389308453,…</td><br>    </tr><br>  </tbody><br></table><br></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##Enter the maximum token and return the length for questioning, here we use Chinese for testing to check the applicability of different languages</span></span><br><span class="line">answer_question(df, question=<span class="string">&quot;测试用例需要满足那些要求?&quot;</span>, debug=<span class="literal">False</span>,use_GPT=<span class="literal">True</span>,max_len=<span class="number">1800</span>,max_tokens = <span class="number">1800</span>)</span><br></pre></td></tr></table></figure>
<pre><code>&apos;测试用例需要满足许多要求，包括但不限于：前提条件、输入数据和期待结果清晰、明确；包含充分的正面、负面异常测试用例；是否从用户层面来设计用户使用场景和使用流程的测试用例；是否简洁，复用性强等。具体要求见上文中的各项检查项。&apos;
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">answer_question(df, question=<span class="string">&quot;一份DD文档或是AD文档需要满足那些要求?,请用中文回答&quot;</span>, debug=<span class="literal">False</span>,use_GPT=<span class="literal">True</span>,max_len=<span class="number">1800</span>,max_tokens = <span class="number">1800</span>)</span><br></pre></td></tr></table></figure>
<pre><code>&apos;DD文档或AD文档需要满足以下要求：\n1. 它应该清晰明了，包括应用的功能、性能、界面、安全等方面。\n2. 它应该易于理解，包括适当的说明、流程图、状态图等。\n3. 它应该满足可复用性、易维护性等软件工程的基本原则。\n4. 它应该包括可靠性需求，描述系统的可用性、健壮性等需求。\n5. 它应该考虑约束和假设，包括客户和MA的约束和假设。\n6. 它应该包括详细设计，以阐明更改的原因和过程，并进行一致性评估。\n7. 它应该考虑软件单元的互操作性、交互、关键性、技术复杂性、风险和可测试性等方面。 \n8. 它应该包括接口定义，以使接口清楚明了。\n9. 历史记录应该得到正确维护。&apos;
</code></pre>
    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/en/tags/python/" rel="tag"># python</a>
              <a href="/en/tags/chatGpt/" rel="tag"># chatGpt</a>
              <a href="/en/tags/algorithm/" rel="tag"># algorithm</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/en/2023/05/12/LeetCode/LeetCode-386/" rel="prev" title="LeetCode-386">
      <i class="fa fa-chevron-left"></i> LeetCode-386
    </a></div>
      <div class="post-nav-item">
    <a href="/en/2023/05/12/algorithm/KMP-algorithm/" rel="next" title="KMP algorithm">
      KMP algorithm <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#Target"><span class="nav-number">1.</span> <span class="nav-text">Target:</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Ray zhou</p>
  <div class="site-description" itemprop="description">My bolg</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/en/archives/">
        
          <span class="site-state-item-count">11</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/en/categories/">
          
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/en/tags/">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ray zhou</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/en/lib/anime.min.js"></script>
  <script src="/en/lib/velocity/velocity.min.js"></script>
  <script src="/en/lib/velocity/velocity.ui.min.js"></script>

<script src="/en/js/utils.js"></script>

<script src="/en/js/motion.js"></script>


<script src="/en/js/schemes/muse.js"></script>


<script src="/en/js/next-boot.js"></script>




  















  

  

  

</body>
</html>
